<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Introduction to clj-bedquilt</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Bedquilt</span> <span class="project-version">2.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="intro.html"><div class="inner"><span>Introduction to clj-bedquilt</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bedquilt</span></div></div></li><li class="depth-2"><a href="bedquilt.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#introduction-to-clj-bedquilt" name="introduction-to-clj-bedquilt"></a>Introduction to clj-bedquilt</h1>
<p><code>clj-bedquilt</code> is the clojure client library for <a href="http://bedquiltdb.github.io">BedquiltDB</a>.</p>
<h2><a href="#installation" name="installation"></a>Installation</h2>
<p><a href="https://clojars.org/bedquilt"><img src="https://img.shields.io/clojars/v/bedquilt.svg" alt="Clojars Project" /></a></p>
<p>Add the following to <code>:dependencies</code> in <code>project.clj</code>:</p>
<pre><code>[bedquilt &quot;2.0.0&quot;]
</code></pre>
<h2><a href="#prerequisites" name="prerequisites"></a>Prerequisites</h2>
<ul>
  <li>Clojure 1.7</li>
  <li>A PostgreSQL server with the <code>bedquilt</code> extension installed (<a href="http://bedquiltdb.readthedocs.org)">http://bedquiltdb.readthedocs.org)</a>.</li>
</ul>
<h2><a href="#further-info-about-bedquiltdb" name="further-info-about-bedquiltdb"></a>Further info about BedquiltDB</h2>
<p>See the <a href="http://bedquiltdb.readthedocs.org/en/latest/guide">BedquiltDB Guide</a>.</p>
<h2><a href="#basic-usage" name="basic-usage"></a>Basic usage</h2>
<p>Require the <code>bedquilt.core</code> namespace:</p>
<pre><code class="clojure"><br/>(ns example.core
  (:require [bedquilt.core :as bq]))

</code></pre>
<p>Make a db spec, with which to connect to the PostgreSQL instance with <code>bedquilt</code> installed:</p>
<pre><code class="clojure"><br/>(def spec
  (bq/make-db-spec {:subname  &quot;//localhost/bedquilt_test&quot;
                    :user     &quot;user&quot;
                    :password &quot;password&quot;}))

</code></pre>
<p>Get a list of collections on the server:</p>
<pre><code class="clojure"><br/>(bq/list-collections spec)
;; =&gt; &#39;(&quot;users&quot; &quot;documents&quot;)

</code></pre>
<p>Create a collection:</p>
<pre><code class="clojure"><br/>(bq/create-collection spec &quot;things&quot;)
;; =&gt; true

</code></pre>
<p>Delete a collection:</p>
<pre><code class="clojure"><br/>(bq/delete-collection spec &quot;things&quot;)
;; =&gt; true

</code></pre>
<p>Check if a collection exists:</p>
<pre><code class="clojure"><br/>(bq/collection-exists? spec &quot;nope&quot;)
;; =&gt; false

</code></pre>
<p>Add constraints to a collection:</p>
<pre><code class="clojure"><br/>(bq/add-constraints spec
  &quot;users&quot;
  {&quot;email&quot; {&quot;$required&quot; true
            &quot;$notnull&quot; true
            &quot;$type&quot; &quot;string&quot;}
   &quot;name&quot;  {&quot;$required&quot; true}})
;; =&gt; true

</code></pre>
<p>Remove constraints to a collection:</p>
<pre><code class="clojure"><br/>(bq/remove-constraints spec
  &quot;users&quot;
  {&quot;name&quot;  {&quot;$required&quot; true}})
;; =&gt; true

</code></pre>
<p>Find documents in a collection:</p>
<pre><code class="clojure"><br/>(bq/find spec &quot;users&quot; {:age 22})
;; =&gt; &#39;({:_id &quot;123&quot;, :age 22, :name &quot;Jim&quot;, ...},  {...}, ...)


(bq/find spec &quot;users&quot; {:address {:city &quot;Glasgow&quot;}}
                      {:sort [{:age 1}], :skip 2, :limit 4})

(bq/find-one spec &quot;users&quot; {:address {:city &quot;Edinburgh&quot;}})
;; =&gt; {:_id &quot;242&quot;, ...}

(bq/find-one-by-id spec &quot;users&quot; &quot;462&quot;)
;; =&gt; {:_id &quot;462&quot;, ...}

</code></pre>
<p>Get a count of documents in a collection:</p>
<pre><code class="clojure"><br/>(bq/count spec &quot;things&quot;)
;; =&gt; 42

(bq/count spec &quot;users&quot; {:age 45})
;; =&gt; 2040

</code></pre>
<p>Get a list of distinct values under a given key path in a collection:</p>
<pre><code class="clojure"><br/>(bq/distinct spec &quot;users&quot; &quot;address.city&quot;)
;; =&gt; &#39;(&quot;Edinburgh&quot; &quot;London&quot; ...)&#39;

</code></pre>
<p>Insert a document in a collection:</p>
<pre><code class="clojure"><br/>(bq/insert spec &quot;users&quot; {:name &quot;Jill&quot;})
;; =&gt; &quot;68e65f4a55246b0e5ce5d075&quot;
;; (returns the _id field of the inserted document)

(bq/save spec &quot;users&quot; {:_id &quot;...&quot; :name &quot;Mike&quot;})
;; =&gt; &quot;10a75a73d607a04044023010&quot;

</code></pre>
<p>Update an existing document:</p>
<pre><code class="clojure"><br/>(let [doc (bq/find-one-by-id spec &quot;users&quot; &quot;123&quot;)
      new-doc (assoc doc :age 24)]
  (bq/save spec &quot;users&quot; new-doc))
;; =&gt; &quot;123&quot;
;; (save either overwrites the document with the same _id, or inserts a new document)

</code></pre>
<p>Even better, do the same with a single connection:</p>
<pre><code class="clojure"><br/>(bq/with-connection [conn spec]
  (let [doc (bq/find-one-by-id conn &quot;users&quot; &quot;123&quot;)
        new-doc (assoc doc :age 24)]
    (bq/save conn &quot;users&quot; new-doc)))

</code></pre>
<p>Remove documents from a collection:</p>
<pre><code class="clojure"><br/>(bq/remove spec &quot;users&quot; {:age 22})
;; =&gt; 45
;; (count of documents removed)

(bq/remove-one spec &quot;users&quot; {:address {:city &quot;Edinburgh&quot;}})
;; =&gt; 1

(bq/remove-one-by-id spec &quot;users&quot; &quot;462&quot;)
;; =&gt; 1

</code></pre></div></div></div></body></html>